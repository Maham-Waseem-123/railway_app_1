{% extends 'base.html' %}

{% block title %}TrainBooking - Home{% endblock %}

{% block content %}
<!-- Chat Assistant -->
<div class="chat-assistant" onclick="toggleChat()">
  <img src="{{ url_for('static', filename='chat-bot.png') }}" alt="Train Assistant" class="assistant-img">
  <div class="speech-bubble" id="speechBubble">
    How can I help with your train booking today? üöÇ
  </div>
</div>

<!-- Chat Container -->
<div id="chatContainer" style="display: none;">
  <div id="chatMessages" class="chat-messages"></div>
  <div class="chat-input">
    <input type="text" id="userInput" placeholder="Ask about bookings, schedules...">
    <button onclick="askQuestion()"><i class="fas fa-paper-plane"></i></button>
  </div>
</div>

<!-- Main Content -->
<div class="hero-section text-center">
  <h1 class="hero-title">Book Your Train Journey</h1>
  <p class="hero-subtitle">Fast, Reliable, and Comfortable Travel</p>

  <!-- Search Form (Table Style) -->
  <div class="search-box">
    <form action="{{ url_for('search_trains') }}" method="POST" class="search-form">
      {{ form.hidden_tag() }}
      <table class="search-table">
        <tr>
          <td>
            <label for="departure_city">From</label><br>
            <input type="text" id="departure_city" name="departure_city" placeholder="Departure City" required>
          </td>
          <td>
            <label for="arrival_city">To</label><br>
            <input type="text" id="arrival_city" name="arrival_city" placeholder="Arrival City" required>
          </td>
          <td>
            <label for="travel_date">Date</label><br>
            <input type="date" id="travel_date" name="travel_date" placeholder="mm/dd/yyyy" required>
          </td>
          <td style="vertical-align: bottom;">
            <button type="submit" class="btn-search">Search Trains</button>
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>

<!-- Features Section -->
<div class="features-section">
  <h2 class="section-title">Why Choose Us?</h2>
  <div class="features-grid">
    <div class="feature-card">
      <i class="fas fa-train feature-icon"></i>
      <h3>Wide Network</h3>
      <p>Connect to major cities across the country with our extensive railway network.</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-clock feature-icon"></i>
      <h3>Real-time Updates</h3>
      <p>Get accurate train schedules and seat availability in real-time.</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-shield-alt feature-icon"></i>
      <h3>Secure Booking</h3>
      <p>Your transactions are safe with our secure payment gateway.</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-headset feature-icon"></i>
      <h3>24/7 Support</h3>
      <p>Our customer support team is always ready to assist you.</p>
    </div>
  </div>
</div>

<!-- Popular Trains -->
<div class="popular-trains">
  <h2 class="section-title">Popular Trains</h2>
  <div class="train-grid">
    {% for train in popular_trains %}
    <div class="train-card {% if loop.last %}center-align{% endif %}">
      <div class="train-header">
        <h3>{{ train.train_name }}</h3>
        <span class="train-number">{{ train.train_number }}</span>
      </div>
      <div class="train-route">
        <span class="departure">{{ train.departure_city }}</span>
        <i class="fas fa-arrow-right"></i>
        <span class="arrival">{{ train.arrival_city }}</span>
      </div>
      <div class="train-actions">
        <a href="{{ url_for('login') }}" class="btn-yellow">Book Now!</a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<style>
  /* Existing Styles */
  body {
    background-color: transparent;
    color: white;
  }

  .hero-section {
    padding: 4rem 1rem;
    text-align: center;
    color: rgb(255, 250, 250);
    background: transparent;
  }

  .hero-title {
    font-size: 3.5rem;
    font-weight: bold;
    color: white;
    margin-bottom: 1rem;
  }

  .hero-subtitle {
    font-size: 1.5rem;
    color: white;
    margin-bottom: 2rem;
  }

  .search-table {
    margin: 0 auto;
    border-collapse: separate;
    border-spacing: 2rem;
  }

  .search-table td {
    text-align: center;
  }

  .search-table input {
    width: 100%;
    padding: 0.75rem;
    background: transparent;
    border: 1px solid rgb(209, 199, 199);
    color: rgb(255, 255, 255);
    border-radius: 5px;
  }

  .search-table input::placeholder {
    color: rgb(248, 248, 248);
  }

  .btn-search {
    background-color: #ffd700;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    font-weight: bold;
    border-radius: 5px;
  }

  .features-section {
    padding: 4rem 0;
  }

  .section-title {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 2rem;
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 2rem;
    max-width: 1200px;
    margin: auto;
  }

  .feature-card {
    border: 1px solid rgba(196, 185, 185, 0.267);
    padding: 2rem;
    border-radius: 10px;
    background: rgba(209, 202, 202, 0.466);
    text-align: center;
  }

  .feature-icon {
    font-size: 2.5rem;
    color: #ffd700;
    margin-bottom: 1rem;
  }

  .popular-trains {
    padding: 4rem 0;
  }

  .train-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    justify-content: space-around;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .train-card {
    width: 300px;
    border: 1px solid rgba(209, 202, 202, 0.781);
    border-radius: 10px;
    background: rgba(209, 202, 202, 0.466);
  }

  .train-card.center-align {
    margin-left: auto;
    margin-right: auto;
  }

  .train-header {
    padding: 1rem;
    background: rgba(255,255,255,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .train-header h3 {
    color: white;
    margin: 0;
  }

  .train-number {
    background: #ffd700;
    color: black;
    padding: 0.3rem 0.7rem;
    border-radius: 20px;
  }

  .train-route {
    padding: 1rem;
    text-align: center;
    font-size: 1.1rem;
  }

  .train-actions {
    text-align: center;
    padding: 1rem;
  }

  .btn-yellow {
    background-color: #ffd700;
    color: white;
    border: none;
    padding: 0.5rem 1.2rem;
    font-weight: bold;
    border-radius: 5px;
    text-decoration: none;
    display: inline-block;
  }

  /* Chat Bot Styles */
  .chat-assistant {
    position: fixed;
    bottom: 20px;
    right: 20px;
    cursor: pointer;
    z-index: 1000;
    transition: transform 0.3s ease;
  }

  .chat-assistant:hover {
    transform: scale(1.05);
  }

  .assistant-img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 3px solid #ffd700;
    box-shadow: 0 0 15px rgba(255,215,0,0.3);
  }

  .speech-bubble {
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffd700;
    color: #000;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: bold;
    width: 200px;
    text-align: center;
    animation: float 3s ease-in-out infinite;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
  }

  @keyframes float {
    0%, 100% { transform: translate(-50%, 0); }
    50% { transform: translate(-50%, -10px); }
  }

  #chatContainer {
    position: fixed;
    bottom: 160px;
    right: 30px;
    width: 300px;
    background: rgba(0,0,0,0.95);
    border-radius: 15px;
    padding: 15px;
    z-index: 1001;
    border: 1px solid #ffd70055;
  }

  .chat-messages {
    height: 200px;
    overflow-y: auto;
    margin-bottom: 10px;
  }

  .chat-input {
    display: flex;
    gap: 8px;
  }

  #userInput {
    flex: 1;
    padding: 8px 12px;
    border-radius: 20px;
    border: 1px solid #ffd700;
    background: transparent;
    color: white;
    font-size: 14px;
  }

  .chat-input button {
    background: #ffd700;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    transition: opacity 0.2s ease;
  }

  .chat-input button:hover {
    opacity: 0.9;
  }

  .user-message {
    color: #ffd700;
    margin: 8px 0;
    text-align: right;
    font-size: 14px;
  }

  .bot-message {
    color: white;
    margin: 8px 0;
    background: rgba(255,215,0,0.1);
    padding: 10px;
    border-radius: 10px;
    font-size: 14px;
    line-height: 1.4;
  }

  .error-message {
    color: #ff4444;
    font-size: 12px;
    text-align: center;
    margin: 8px 0;
  }
</style>

<script>
// Chat functionality
let chatVisible = false;

function toggleChat() {
  const container = document.getElementById('chatContainer');
  const bubble = document.getElementById('speechBubble');
  chatVisible = !chatVisible;
  container.style.display = chatVisible ? 'block' : 'none';
  bubble.style.display = chatVisible ? 'none' : 'block';
}

async function askQuestion() {
  const input = document.getElementById('userInput');
  const messages = document.getElementById('chatMessages');
  const question = input.value.trim();
  
  if (!question) return;

  // Add user message
  messages.innerHTML += `
    <div class="user-message">
      <span>${question}</span>
    </div>
  `;

  try {
    const response = await fetch('/ask', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({question: question})
    });

    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    
    const data = await response.json();
    
    messages.innerHTML += `
      <div class="bot-message">
        <span>${data.answer || 'Sorry, I didn\'t understand that question.'}</span>
      </div>
    `;

  } catch (error) {
    console.error('Error:', error);
    messages.innerHTML += `
      <div class="error-message">
        <span>‚ö†Ô∏è Our support team is currently busy. Please try again later.</span>
      </div>
    `;
  }

  input.value = '';
  messages.scrollTop = messages.scrollHeight;
}
</script>

{% endblock %}
